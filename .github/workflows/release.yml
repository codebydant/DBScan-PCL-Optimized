name: Deployment Image

on:
  push:
    branches: ["test-github-packages"]
  workflow_dispatch:
    inputs:
      environment:
        type: string
        default: DEV
        required: true

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Build project
        # uses: danielTobon43/PCL-Build-Action@feat-cmake-flags
        uses: ./PCL-Build-Action
        with:
          build_flags: >
            -DCMAKE_BUILD_TYPE=Release 
            -DCMAKE_C_COMPILER=clang 
            -DCMAKE_CXX_COMPILER=clang++
          make_install: true

      # - name: Build image
      #   run: docker build --file Dockerfile --tag $IMAGE_NAME --label "runnumber=${GITHUB_RUN_ID}" .

      # - name: Download bad Image
      #   run: |
      #     docker pull ghcr.io/danieltobon43/dbscan-octrees:latest

      # - name: Test bad Image
      #   run: |
      #     docker run --rm \
      #     --env="DISPLAY" \
      #     --env="QT_X11_NO_MITSHM=1" \
      #     --volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
      #     ghcr.io/danieltobon43/dbscan-octrees:latest

      # - name: Download good Image
      #   run: |
      #     docker pull ghcr.io/danieltobon43/dbscan-octrees:goodapp

      # - name: Test good Image
      #   run: |
      #     docker run --rm \
      #     --env="DISPLAY" \
      #     --env="QT_X11_NO_MITSHM=1" \
      #     --volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
      #     ghcr.io/danieltobon43/dbscan-octrees:goodapp
